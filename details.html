<section data-gjs-highlightable="true" id="irlne6" data-gjs-type="default" draggable="true"
    class="w-full min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300 flex flex-col items-center py-8 md:py-16 px-4 md:px-0">
    <div data-gjs-highlightable="true" id="iaxve9" data-gjs-type="html" draggable="true"
        class="max-w-3xl w-full text-center mx-auto">
        <h1 data-gjs-highlightable="true" id="i0pat5" data-gjs-type="text" draggable="true"
            class="text-3xl md:text-5xl font-extrabold tracking-tight text-gray-900 dark:text-white mb-6">Spotless Bin
            Co Service Checkout
        </h1>
        <p data-gjs-highlightable="true" id="isk682" data-gjs-type="text" draggable="true"
            class="mb-12 text-base sm:text-lg text-gray-700 dark:text-gray-300">Book a professional curbside bin
            cleaning with a streamlined, official process. Simply verify your address. Then, review your order and
            complete secure payment for a cleaner, fresher home. Questions?
            <span id="i74v0w" data-gjs-type="text" draggable="true" class="underline">Contact us</span>.
        </p>
    </div>
    <!-- Order Process Panel Start -->
    <div data-gjs-highlightable="true" id="ixz03k" data-gjs-type="html" draggable="true"
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl mx-auto p-0 overflow-hidden flex flex-col transition-all">
        <!-- Step 1: Order Summary/Header -->
        <div data-gjs-highlightable="true" id="isp3vy" data-gjs-type="html" draggable="true"
            class="border-b border-gray-200 dark:border-gray-700 px-6 py-6">
            <h2 data-gjs-highlightable="true" id="iq9egd" data-gjs-type="text" draggable="true"
                class="text-2xl font-bold mb-2 text-black dark:text-white">Order Summary
            </h2>
            <div data-gjs-highlightable="true" id="irwawy" data-gjs-type="html" draggable="true"
                class="flex items-center gap-4">
                <div data-gjs-highlightable="true" id="i5atnt" data-gjs-type="html" draggable="true"
                    class="shrink-0 w-14 h-14 flex items-center justify-center rounded bg-gradient-to-tr from-green-500 to-lime-400 dark:from-green-700 dark:to-lime-500">
                    <img id="i8056d" data-gjs-type="image" draggable="true"
                        src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3R5bGU9ImZpbGw6IHJnYmEoMCwwLDAsMC4xNSk7IHRyYW5zZm9ybTogc2NhbGUoMC43NSkiPgogICAgICAgIDxwYXRoIGQ9Ik0yLjI4IDNMMSA0LjI3bDIgMlYxOWMwIDEuMS45IDIgMiAyaDEyLjczbDIgMkwyMSAyMS43MiAyLjI4IDNtMi41NSAwTDIxIDE5LjE3VjVhMiAyIDAgMCAwLTItMkg0LjgzTTguNSAxMy41bDIuNSAzIDEtMS4yNUwxNC43MyAxOEg1bDMuNS00LjV6Ij48L3BhdGg+CiAgICAgIDwvc3ZnPg=="
                        alt="Bin icon" class="w-9 h-9">
                </div>
                <div data-gjs-highlightable="true" id="igwqwg" data-gjs-type="html" draggable="true"
                    class="flex-1 text-left">
                    <h3 data-gjs-highlightable="true" id="ispaqv" data-gjs-type="text" draggable="true"
                        class="font-semibold text-gray-900 dark:text-white text-lg leading-6 mb-0">Curbside Bin Cleaning
                    </h3>
                    <div data-gjs-highlightable="true" id="ia3qhf" data-gjs-type="html" draggable="true"
                        class="text-gray-600 dark:text-gray-300 text-sm">Eco-friendly, high-pressure cleaning &amp;
                        deodorizing
                    </div>
                </div>
                <div data-gjs-highlightable="true" id="ioazcz" data-gjs-type="html" draggable="true" class="text-right">
                    <span data-gjs-highlightable="true" id="iy30al" data-gjs-type="text" draggable="true"
                        class="text-green-700 dark:text-green-400 font-bold text-xl">$29.00</span>
                    <div data-gjs-highlightable="true" id="if1yl4" data-gjs-type="html" draggable="true"
                        class="text-xs text-gray-500">(per bin)
                    </div>
                </div>
            </div>
        </div>
        <!-- Step 2: Address Validation -->
        <form data-gjs-highlightable="true" id="service-form" data-gjs-type="default" draggable="true"
            autocomplete="off" class="px-6 py-6 flex flex-col gap-6">
            <div data-gjs-highlightable="true" id="ic5vks" data-gjs-type="html" draggable="true" class="w-full">
                <label data-gjs-highlightable="true" id="ilh5yl" data-gjs-type="label" draggable="true" for="address"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Service Address</label>
                <input data-gjs-highlightable="true" id="address" data-gjs-type="default" draggable="true" type="text"
                    required="true" name="address" placeholder="123 Main St"
                    class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition disabled:opacity-70">
            </div>
            <div data-gjs-highlightable="true" id="icop1m" data-gjs-type="html" draggable="true"
                class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <div data-gjs-highlightable="true" id="ittzp1" data-gjs-type="html" draggable="true">
                    <label data-gjs-highlightable="true" id="imgdiw" data-gjs-type="label" draggable="true" for="city"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">City</label>
                    <input data-gjs-highlightable="true" id="city" data-gjs-type="default" draggable="true" type="text"
                        required="true" name="city" placeholder="Your City"
                        class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div data-gjs-highlightable="true" id="ijwid6" data-gjs-type="html" draggable="true">
                    <label data-gjs-highlightable="true" id="itm16x" data-gjs-type="label" draggable="true" for="state"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">State</label>
                    <input data-gjs-highlightable="true" id="state" data-gjs-type="default" draggable="true" type="text"
                        required="true" name="state" placeholder="TX" maxlength="2"
                        class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
                <div data-gjs-highlightable="true" id="i1ld3l" data-gjs-type="html" draggable="true">
                    <label data-gjs-highlightable="true" id="i5yfne" data-gjs-type="label" draggable="true" for="zip"
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ZIP</label>
                    <input data-gjs-highlightable="true" id="zip" data-gjs-type="default" draggable="true" type="text"
                        required="true" name="zip" placeholder="99999" maxlength="10"
                        class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                </div>
            </div>
            <div data-gjs-highlightable="true" id="ik23kp" data-gjs-type="html" draggable="true" class="">
                <label data-gjs-highlightable="true" id="i9d7g3" data-gjs-type="label" draggable="true" for="trash_day"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Your Trash Day</label>
                <select data-gjs-highlightable="true" id="trash_day" data-gjs-type="default" draggable="true"
                    required="true" name="trash_day"
                    class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option data-gjs-highlightable="true" id="ibpnci" data-gjs-type="text" draggable="true" value="">
                        Select</option>
                    <option data-gjs-highlightable="true" id="ib99hj" data-gjs-type="text" draggable="true">Monday
                    </option>
                    <option data-gjs-highlightable="true" id="ibz2os" data-gjs-type="text" draggable="true">Tuesday
                    </option>
                    <option data-gjs-highlightable="true" id="ib3jbh" data-gjs-type="text" draggable="true">Wednesday
                    </option>
                    <option data-gjs-highlightable="true" id="io8j7j" data-gjs-type="text" draggable="true">Thursday
                    </option>
                    <option data-gjs-highlightable="true" id="ioo2qk" data-gjs-type="text" draggable="true">Friday
                    </option>
                    <option data-gjs-highlightable="true" id="im2ui7" data-gjs-type="text" draggable="true">Saturday
                    </option>
                </select>
            </div>
            <button data-gjs-highlightable="true" id="check-address" data-gjs-type="text" draggable="true" type="button"
                class="w-full md:w-auto px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-400 dark:focus:ring-blue-800 shadow transition disabled:opacity-50">Check
                Service Availability</button>
            <div data-gjs-highlightable="true" id="address-message" data-gjs-type="html" draggable="true"
                class="min-h-[24px] text-sm font-medium text-red-600">Error checking address. Please try again later.
            </div>
        </form>
        <!-- Step 3: Payment (hidden, shown after address check) -->
        <form data-gjs-highlightable="true" id="checkout-form" data-gjs-type="default" draggable="true"
            class="hidden px-6 pb-6 flex flex-col gap-6">
            <div data-gjs-highlightable="true" id="ikw9yt" data-gjs-type="html" draggable="true"
                class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div data-gjs-highlightable="true" id="isc0gf" data-gjs-type="html" draggable="true">
                    <label data-gjs-highlightable="true" id="ibz18o" data-gjs-type="label" draggable="true"
                        for="first_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">First
                        Name</label>
                    <input data-gjs-highlightable="true" id="first_name" data-gjs-type="default" draggable="true"
                        type="text" name="first_name" required="true"
                        class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div data-gjs-highlightable="true" id="ivtig5" data-gjs-type="html" draggable="true">
                    <label data-gjs-highlightable="true" id="idmif8" data-gjs-type="label" draggable="true"
                        for="last_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Last
                        Name</label>
                    <input data-gjs-highlightable="true" id="last_name" data-gjs-type="default" draggable="true"
                        type="text" name="last_name" required="true"
                        class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div data-gjs-highlightable="true" id="iw1z1q" data-gjs-type="html" draggable="true">
                <label data-gjs-highlightable="true" id="i95j57" data-gjs-type="label" draggable="true" for="email"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                <input data-gjs-highlightable="true" id="email" data-gjs-type="default" draggable="true" type="email"
                    name="email" required="true"
                    class="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div data-gjs-highlightable="true" id="iiacfl" data-gjs-type="html" draggable="true"
                class="p-4 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700">
                <label data-gjs-highlightable="true" id="iwu8yr" data-gjs-type="label" draggable="true"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-3">Card Details</label>
                <div data-gjs-highlightable="true" id="payment-element" data-gjs-type="html" draggable="true">
                </div>
                <div data-gjs-highlightable="true" id="stripe-message" data-gjs-type="html" draggable="true"
                    class="hidden mt-2 text-red-600 dark:text-red-400 text-sm">
                </div>
            </div>
            <button data-gjs-highlightable="true" id="complete-order" data-gjs-type="text" draggable="true"
                type="submit"
                class="w-full md:w-auto px-6 py-3 rounded-lg font-extrabold text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-400 dark:focus:ring-green-800 shadow transition disabled:opacity-50">Pay
                &amp; Schedule</button>
        </form>
        <!-- Finish -->
    </div>
    <div data-gjs-highlightable="true" id="iuphvt" data-gjs-type="html" draggable="true"
        class="py-10 text-center max-w-xl mx-auto">
        <p data-gjs-highlightable="true" id="issgkr" data-gjs-type="text" draggable="true"
            class="text-xs text-gray-500 dark:text-gray-400 font-medium">Powered by RC Ventures LLC · All rights
            reserved ·
            <span id="iqbmhc" data-gjs-type="text" draggable="true" class="underline">Privacy Policy</span>
        </p>
    </div>
    <!-- Stripe & Script -->
    <script id="iy3c9u" data-gjs-type="script" src="https://js.stripe.com/v3/"></script>
    <script id="iy13rf" data-gjs-type="script">
        // --- Constants ---
        const MODAL_REDIRECT_DELAY_MS = 1000;

        // --- Utility Functions ---
        function showMessage(msg, type) {
            const el = document.getElementById('address-message');
            el.textContent = msg;
            el.className = 'min-h-[24px] text-sm font-medium';
            if (type === 'success') el.classList.add('text-green-600');
            if (type === 'error') el.classList.add('text-red-600');
            if (type === 'loading') el.classList.add('text-blue-600');
            if (type === 'info') el.classList.add('text-gray-700');
        }
        function formatPrice(amount, currency = 'usd') {
            if (typeof amount !== 'number') return amount;
            return new Intl.NumberFormat('en-US', {
                style: 'currency', currency: currency.toUpperCase()
            }
            ).format(amount);
        }
        // --- Address Check Handler ---
        const addrForm = document.getElementById('service-form');
        const checkoutForm = document.getElementById('checkout-form');
        let stripe, paymentElement, elements, clientSecret, stripeMessage;
        document.getElementById('check-address').addEventListener('click', async (e) => {
            e.preventDefault();
            // Validate form fields
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const state = document.getElementById('state').value.trim();
            const zip = document.getElementById('zip').value.trim();
            const trashDay = document.getElementById('trash_day').value;
            if (!address || !city || !state || !zip || !trashDay) {
                showMessage('Please fill out all address fields and select trash day.', 'error');
                return;
            }
            showMessage('Checking availability...', 'loading');
            e.target.disabled = true;
            // API to check zone
            try {
                const resp = await fetch('/api/geocode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                    ,
                    body: JSON.stringify({
                        address: {
                            line1: address, city, state, postal_code: zip
                        }
                        ,
                        trash_day: trashDay
                    }
                    )
                }
                );
                if (!resp.ok) throw new Error('Service address check failed');
                const data = await resp.json();
                if (!data.inside_zone) {
                    showMessage(data.error ? data.error : 'Sorry, service is not available for this address.', 'error');
                    e.target.disabled = false;
                    return;
                }
                
                // Check if there's a redirect URL (for authenticated flow)
                if (data.redirect_url) {
                    showMessage('Service is available! Redirecting to checkout...', 'success');
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, MODAL_REDIRECT_DELAY_MS);
                    return;
                }
                
                // Otherwise, show inline checkout form (for unauthenticated flow)
                showMessage('Service is available! Next cleaning: ' + (data.next_service_day || 'as scheduled'), 'success');
                setTimeout(() => {
                    addrForm.classList.add('pointer-events-none', 'opacity-60');
                    checkoutForm.classList.remove('hidden');
                    document.getElementById('first_name').focus();
                }
                    , 1100);
            }
            catch (err) {
                showMessage('Error checking address. Please try again later.', 'error');
            }
            e.target.disabled = false;
        }
        );
        // --- Payment Handler ---
        checkoutForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            // Fetch required info
            const orderData = {
                product_id: 'bin-clean-1',
                quantity: 1,
                first_name: document.getElementById('first_name').value.trim(),
                last_name: document.getElementById('last_name').value.trim(),
                email: document.getElementById('email').value.trim(),
                address_line1: document.getElementById('address').value.trim(),
                address_city: document.getElementById('city').value.trim(),
                address_state: document.getElementById('state').value.trim(),
                address_zip: document.getElementById('zip').value.trim(),
                trash_day: document.getElementById('trash_day').value
            };
            if (!orderData.first_name || !orderData.last_name || !orderData.email) {
                showMessage('Please fill in your name and email to continue', 'error');
                return;
            }
            // Load Stripe
            if (!stripe) stripe = Stripe("pk_test_placeholder");
            // Replace key server-side
            // Create Checkout Session
            try {
                const stripeSession = await fetch('/api/stripe/checkout-sessions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                    ,
                    body: JSON.stringify(orderData)
                }
                );
                const session = await stripeSession.json();
                if (session.client_secret) {
                    if (!elements) {
                        elements = stripe.elements({
                            clientSecret: session.client_secret
                        }
                        );
                        paymentElement = elements.create('payment');
                        paymentElement.mount('#payment-element');
                    }
                    clientSecret = session.client_secret;
                }
                else {
                    showMessage('Payment unavailable at this time', 'error');
                    return;
                }
            }
            catch (err) {
                showMessage('Could not initialize payment. Please try again later.', 'error');
                return;
            }
            // Confirm Payment
            const submitBtn = document.getElementById('complete-order');
            submitBtn.disabled = true;
            stripeMessage = document.getElementById('stripe-message');
            stripeMessage?.classList.add('hidden');
            const {
                error }
                = await stripe.confirmPayment({
                    elements,
                    confirmParams: {
                        return_url: window.location.origin + '/thank-you',
                        receipt_email: orderData.email,
                        payment_method_data: {
                            billing_details: {
                                email: orderData.email, name: orderData.first_name + ' ' + orderData.last_name
                            }
                        }
                        ,
                    }
                }
                );
            if (error) {
                stripeMessage.textContent = error.message;
                stripeMessage.classList.remove('hidden');
                submitBtn.disabled = false;
            }
        }
        );
    </script>
</section>